<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mestre das Equa√ß√µes</title>
    
    <!-- Configura√ß√£o para garantir que os s√≠mbolos $ n√£o aparecem aos alunos antes de renderizar -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']], 
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
    </script>
    <!-- Carregar MathJax para renderizar equa√ß√µes matem√°ticas reais -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #50e3c2;
            --accent: #ff6b6b;
            --background: #f4f7f6;
            --text: #2c3e50;
            --card-bg: #ffffff;
            --hint-bg: #fff0f0;
            --tab-active: #e1f0ff;
            --balance-color: #34495e;
            --board-color: #ffeaa7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- UI Elements --- */
        .container { width: 95%; max-width: 800px; margin-top: 20px; text-align: center; padding-bottom: 40px; }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        h1 { color: var(--primary); margin-bottom: 0.5em; }
        h2 { color: var(--primary); font-size: 1.4rem; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;}
        h3 { color: #34495e; font-size: 1.1rem; margin-top: 25px; font-weight: 700;}
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: inline-block;
            font-weight: 600;
        }
        .btn:hover { background-color: #357abd; transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        .btn-secondary { background-color: #95a5a6; }
        .btn-accent { background-color: var(--accent); }
        .btn-game { background-color: #9b59b6; }
        .btn-game:hover { background-color: #8e44ad; }
        .btn-small { font-size: 0.85rem; padding: 5px 15px; }

        /* --- Balance Scale Simulator --- */
        .balance-container {
            display: flex; flex-direction: column; align-items: center;
            margin: 20px auto; height: 180px; width: 100%; max-width: 400px; position: relative;
        }
        .balance-beam {
            width: 80%; height: 6px; background-color: var(--balance-color);
            position: relative; top: 50px; transition: transform 0.5s ease; transform-origin: center;
        }
        .tilt-left { transform: rotate(-15deg); }
        .tilt-right { transform: rotate(15deg); }
        .balanced { transform: rotate(0deg); }

        .balance-fulcrum {
            width: 0; height: 0; 
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 40px solid var(--balance-color);
            position: absolute; top: 56px; left: 50%; transform: translateX(-50%);
        }
        .pan { width: 80px; height: 5px; background-color: var(--balance-color); position: absolute; top: 30px; }
        .pan-left { left: 0; } .pan-right { right: 0; }
        .pan-string { width: 2px; height: 30px; background-color: #bdc3c7; position: absolute; top: 0; }
        .string-l1 { left: 0; } .string-l2 { left: 80px; } .string-r1 { right: 0; } .string-r2 { right: 80px; }

        .pan-plate {
            width: 100px; height: 10px; background-color: #95a5a6; border-radius: 0 0 50px 50px;
            position: absolute; top: 30px; display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 5px; flex-wrap: wrap-reverse; gap: 2px; transition: transform 0.5s ease;
        }
        .plate-left { left: -10px; } .plate-right { right: -10px; }

        .weight-box {
            width: 25px; height: 25px; background-color: var(--primary); color: white;
            display: flex; align-items: center; justify-content: center; border-radius: 3px;
            font-size: 0.9rem; font-family: 'Times New Roman', serif; font-style: italic; font-weight: bold;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2); margin: 1px;
        }
        .weight-circle {
            width: 20px; height: 20px; background-color: var(--accent); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2); margin: 1px;
        }

        /* --- Game Elements --- */
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; color: #7f8c8d; }
        .progress-container { width: 100%; background-color: #e0e0e0; border-radius: 10px; margin: 15px 0; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background-color: var(--secondary); width: 0%; transition: width 0.5s ease; }
        .equation-display { font-size: 1.8rem; margin: 20px 0; padding: 20px; background-color: #f8f9fa; border-radius: 10px; border-left: 5px solid var(--primary); }
        #visual-hint-container { font-size: 1.2rem; margin: 20px 0; padding: 15px; background-color: var(--hint-bg); border: 2px dashed var(--accent); border-radius: 10px; }
        input[type="number"] { padding: 10px; font-size: 1.2rem; border: 2px solid #bdc3c7; border-radius: 8px; width: 100px; text-align: center; }

        .feedback { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; text-align: left; line-height: 1.6; }
        .correct { background-color: #d4edda; color: #155724; }
        .incorrect { background-color: #f8d7da; color: #721c24; }

        /* --- Modal --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 0; border-radius: 15px; max-width: 700px; width: 95%; height: 90vh; display: flex; flex-direction: column; overflow: hidden; }
        .modal-header { display: flex; background-color: #f1f2f6; border-bottom: 1px solid #ddd; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 15px 10px; border: none; background: none; cursor: pointer; font-weight: bold; color: #7f8c8d; transition: 0.3s; white-space: nowrap; }
        .tab-btn.active { background-color: white; color: var(--primary); border-bottom: 3px solid var(--primary); }
        .modal-body { padding: 30px; overflow-y: auto; text-align: left; flex-grow: 1; }
        .example-box { background-color: #f8f9fa; border-left: 4px solid var(--secondary); padding: 10px 15px; margin: 10px 0; }
        .definition-box { background-color: #eaf2f8; border: 1px solid #d6eaf8; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .activity-item { background: #fff; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .hidden { display: none !important; }
        .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
        .col { flex: 1; min-width: 200px; }

        /* Estilos do Lab */
        .lab-controls-top { background: #e1f0ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 10px; }
        .control-group { display: flex; align-items: center; justify-content: space-between; background: white; padding: 5px 10px; border-radius: 5px; margin-bottom: 5px; border: 1px solid #eee; }

        /* --- Games CSS --- */
        .board-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px auto; max-width: 500px; }
        .board-cell { aspect-ratio: 1; background-color: var(--board-color); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }
        .board-cell.start { background-color: #55efc4; color: #00b894; }
        .board-cell.finish { background-color: #fab1a0; color: #d63031; }
        .player-token { width: 30px; height: 30px; background-color: var(--primary); border: 3px solid white; border-radius: 50%; position: absolute; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: all 0.5s ease; }

        .memory-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin: 20px 0; }
        .memory-card { aspect-ratio: 3/4; background-color: var(--primary); border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: white; transition: transform 0.3s, background-color 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .memory-card.flipped { background-color: white; color: var(--text); border: 2px solid var(--primary); transform: rotateY(180deg); }
        .memory-card.matched { background-color: #d4edda; border-color: #27ae60; color: #27ae60; cursor: default; }

        .domino-table { background-color: #2c3e50; min-height: 150px; border-radius: 10px; padding: 20px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 5px; margin-bottom: 20px; overflow-x: auto; }
        .domino-hand { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .domino-piece { display: flex; width: 120px; height: 60px; background-color: white; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s; }
        .domino-piece:hover { transform: translateY(-3px); }
        .domino-half { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; border-right: 1px solid #ccc; padding: 2px; }
        .domino-half:last-child { border-right: none; }
        .domino-piece.on-table { cursor: default; transform: none; box-shadow: none; margin: 2px; }

        .bingo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px auto; max-width: 300px; }
        .bingo-cell { aspect-ratio: 1; background-color: white; border: 2px solid var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: var(--text); cursor: pointer; transition: background-color 0.2s; }
        .bingo-cell:hover { background-color: #f0f0f0; }
        .bingo-cell.marked { background-color: var(--secondary) !important; color: white !important; border-color: #2ecc71 !important; }
        .bingo-ball { width: 100%; background-color: white; border: 2px dashed var(--accent); border-radius: 15px; padding: 20px; margin-bottom: 20px; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* --- Zoom Image --- */
        .zoomable-img { cursor: zoom-in; transition: transform 0.3s ease; }
        .zoomable-img.zoomed { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2000; 
            object-fit: contain; background-color: rgba(0,0,0,0.9); padding: 20px; 
            box-sizing: border-box; cursor: zoom-out; 
            max-width: none !important; border: none !important; border-radius: 0 !important; 
        }
    </style>
</head>
<body>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div style="font-weight: bold; font-size: 1.2rem; color: var(--text);">‚öñÔ∏è EquaMaster</div>
            <button class="btn btn-secondary btn-small" onclick="openGuide()">üìò Guia de Estudo</button>
        </div>

        <!-- MENU INICIAL -->
        <div id="screen-menu" class="card">
            <h1>Aventura Alg√©brica</h1>
            <p>Domina a arte do equil√≠brio e resolve problemas com rigor matem√°tico.</p>
            <br>
            <div style="display: flex; flex-direction: column; gap: 10px; max-width: 300px; margin: 0 auto;">
                <button class="btn" onclick="startGame()">üöÄ Iniciar Jornada</button>
                <button class="btn btn-accent" onclick="startLab()">üß™ Laborat√≥rio</button>
                <button class="btn btn-game" onclick="showGamesMenu()">üéÆ Sala de Jogos</button>
            </div>
            <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 20px;">Dica: Consulta o novo Guia de Estudo!</p>
        </div>

        <!-- MENU JOGOS -->
        <div id="screen-games-menu" class="card hidden">
            <button class="btn btn-secondary btn-small" onclick="showMenu()" style="float: left;">‚¨Ö Voltar</button>
            <h1 style="clear: both; margin-top: 10px;">Sala de Jogos</h1>
            <p>Escolhe o teu desafio l√∫dico:</p>
            <br>
            <div class="row" style="justify-content: center;">
                <button class="btn btn-game col" onclick="startBoardGame()">üé≤ Tabuleiro</button>
                <button class="btn btn-game col" onclick="startMemoryGame()">üß† Mem√≥ria</button>
            </div>
            <div class="row" style="justify-content: center;">
                <button class="btn btn-game col" onclick="startDominoGame()">üÅö Domin√≥</button>
                <button class="btn btn-game col" onclick="startBingoGame()">üé± Bingo</button>
            </div>
        </div>

        <!-- JOGO 1: TABULEIRO -->
        <div id="screen-game-board" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary btn-small" onclick="showGamesMenu()">Sair</button>
                <h2>Corrida das Equa√ß√µes</h2>
                <div style="width: 50px;"></div>
            </div>
            <div class="board-grid" id="board-container"></div>
            <p id="board-message">Lan√ßa o dado para come√ßar!</p>
            <button id="btn-roll-dice" class="btn btn-game" onclick="rollDice()">üé≤ Lan√ßar Dado</button>
        </div>

        <!-- JOGO 2: MEM√ìRIA -->
        <div id="screen-game-memory" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary btn-small" onclick="showGamesMenu()">Sair</button>
                <h2>Mem√≥ria Alg√©brica</h2>
                <span>Pares: <strong id="memory-score">0</strong>/6</span>
            </div>
            <p>Encontra o par: Equa√ß√£o ‚Üî Solu√ß√£o</p>
            <div class="memory-grid" id="memory-container"></div>
            <button id="btn-restart-memory" class="btn hidden" onclick="startMemoryGame()">Jogar Novamente</button>
        </div>

        <!-- JOGO 3: DOMIN√ì -->
        <div id="screen-game-domino" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary btn-small" onclick="showGamesMenu()">Sair</button>
                <h2>Domin√≥ de Equa√ß√µes</h2>
                <div style="width: 50px;"></div>
            </div>
            <p>Liga a <strong>Solu√ß√£o</strong> de uma pe√ßa √† <strong>Equa√ß√£o</strong> da pr√≥xima (ou vice-versa).</p>
            <div class="domino-table" id="domino-table"><span style="color: white; font-style: italic;">A mesa est√° vazia...</span></div>
            <h3>A tua M√£o:</h3>
            <div class="domino-hand" id="domino-hand"></div>
            <p id="domino-msg" style="margin-top: 15px; color: var(--accent); font-weight: bold;"></p>
            <button id="btn-restart-domino" class="btn hidden" onclick="startDominoGame()">Jogar Novamente</button>
        </div>

        <!-- JOGO 4: BINGO -->
        <div id="screen-game-bingo" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary btn-small" onclick="showGamesMenu()">Sair</button>
                <h2>Bingo Alg√©brico</h2>
                <div style="width: 50px;"></div>
            </div>
            <div class="bingo-ball">
                <span style="font-size: 0.9rem; color: #7f8c8d; text-transform: uppercase; font-weight: bold;">Chamada Atual</span>
                <div id="bingo-current-call" style="font-size: 2rem; margin-top: 10px;"></div>
            </div>
            <p>Resolve a equa√ß√£o e marca o resultado na tua cartela!</p>
            <div class="bingo-grid" id="bingo-card"></div>
            <button id="btn-next-bingo" class="btn btn-game" onclick="nextBingoCall()">Sorteiar Pr√≥xima Equa√ß√£o üé±</button>
            <div id="bingo-status" style="margin-top: 15px; font-weight: bold; min-height: 40px; padding: 10px;"></div>
        </div>

        <!-- JORNADA -->
        <div id="screen-game" class="card hidden">
            <div class="status-bar">
                <span id="level-indicator">N√≠vel 1</span>
                <span>‚ù§Ô∏è <span id="lives">3</span></span>
                <span>‚≠ê <span id="score">0</span></span>
                <button class="btn btn-secondary btn-small" onclick="showMenu()" style="margin: 0; padding: 2px 10px;">Sair</button>
            </div>
            <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
            <div id="balance-area" class="hidden"></div>
            <div id="visual-text-area" class="visual-aid hidden"></div>
            <p id="question-text" style="font-size: 1.1rem;"></p>
            <div class="equation-display" id="question-equation"></div>
            <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem; font-family: 'Times New Roman', serif; font-style: italic;">x = </span>
                <input type="number" id="user-input" autocomplete="off">
            </div>
            <div id="visual-hint-wrapper" style="margin-top: 15px;">
                <button id="btn-visual-hint" class="btn btn-accent hidden" onclick="showVisualHint()">üëÅÔ∏è Ver Pista</button>
                <div id="visual-hint-container" class="hidden"></div>
            </div>
            <div id="feedback-area" class="feedback"></div>
            <div style="margin-top: 20px;">
                <button id="btn-check" class="btn" onclick="checkAnswer()">Verificar Solu√ß√£o</button>
                <button id="btn-next" class="btn hidden" onclick="nextQuestion()">Pr√≥ximo Desafio ‚û°</button>
            </div>
        </div>

        <!-- LABORAT√ìRIO (CORRIGIDO) -->
        <div id="screen-lab" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button class="btn btn-secondary btn-small" onclick="showMenu()">‚¨Ö Voltar</button>
                <h2>üß™ Laborat√≥rio</h2>
                <div style="width: 80px;"></div>
            </div>
            <div class="lab-controls-top">
                <label for="lab-x-value">Defina o "Valor Secreto" de <strong>$x$</strong>:</label>
                <input type="range" id="lab-x-value" min="1" max="10" value="5" oninput="updateLab()" style="width: 150px;">
                <span id="lab-x-display" style="font-weight: bold; font-size: 1.5rem; color: var(--accent); margin-left: 10px; width: 30px;">5</span>
            </div>
            <div id="lab-balance-area"></div>
            <div class="equation-display" id="lab-equation" style="min-height: 80px; display: flex; align-items: center; justify-content: center;"></div>
            <div class="row">
                <div class="col card" style="background: #f8f9fa; padding: 15px; margin: 0;">
                    <h3 style="margin-top: 0;">Prato Esquerdo</h3>
                    <div class="control-group">
                        <span>Caixas ($x$):</span>
                        <div><button class="btn btn-small btn-secondary" onclick="adjustLab('left', 'x', -1)">-</button><span id="count-left-x" style="font-weight: bold; margin: 0 5px;">0</span><button class="btn btn-small" onclick="adjustLab('left', 'x', 1)">+</button></div>
                    </div>
                    <div class="control-group">
                        <span>Pesos (1):</span>
                        <div><button class="btn btn-small btn-secondary" onclick="adjustLab('left', 'u', -1)">-</button><span id="count-left-u" style="font-weight: bold; margin: 0 5px;">0</span><button class="btn btn-small" onclick="adjustLab('left', 'u', 1)">+</button></div>
                    </div>
                </div>
                <div class="col card" style="background: #f8f9fa; padding: 15px; margin: 0;">
                    <h3 style="margin-top: 0;">Prato Direito</h3>
                    <div class="control-group">
                        <span>Caixas ($x$):</span>
                        <div><button class="btn btn-small btn-secondary" onclick="adjustLab('right', 'x', -1)">-</button><span id="count-right-x" style="font-weight: bold; margin: 0 5px;">0</span><button class="btn btn-small" onclick="adjustLab('right', 'x', 1)">+</button></div>
                    </div>
                     <div class="control-group">
                        <span>Pesos (1):</span>
                        <div><button class="btn btn-small btn-secondary" onclick="adjustLab('right', 'u', -1)">-</button><span id="count-right-u" style="font-weight: bold; margin: 0 5px;">0</span><button class="btn btn-small" onclick="adjustLab('right', 'u', 1)">+</button></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RELAT√ìRIO -->
        <div id="screen-report" class="card hidden">
            <h1>Jornada Conclu√≠da! üéâ</h1>
            <p>Pontua√ß√£o Final: <strong id="final-score"></strong></p>
            <div id="report-details" style="text-align: left; margin: 20px 0; max-height: 300px; overflow-y: auto;"></div>
            <button class="btn" onclick="location.reload()">Jogar Novamente</button>
        </div>
    </div>

    <!-- MODAIS -->
    <div id="modal-board-question" class="modal">
        <div class="modal-content" style="max-height: auto; height: auto; padding: 20px;">
            <h3>Desafio do Tabuleiro</h3>
            <div id="board-q-text" style="font-size: 1.2rem; margin: 15px 0;"></div>
            <input type="number" id="board-input" placeholder="x = ?">
            <div id="board-feedback" style="margin: 10px; font-weight: bold;"></div>
            <button class="btn" onclick="checkBoardAnswer()">Responder</button>
        </div>
    </div>

    <div id="modal-guide" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="tab-btn active" onclick="switchTab('tab-def')">1. Defini√ß√µes</button>
                <button class="tab-btn" onclick="switchTab('tab-solve')">2. Como Resolver</button>
                <button class="tab-btn" onclick="switchTab('tab-act')">3. Atividades</button>
                <button class="tab-btn" onclick="switchTab('tab-prob')">4. Problemas</button>
                <button class="tab-btn" onclick="switchTab('tab-plan')">5. Plano de Aula</button>
            </div>
            
            <div id="tab-def" class="modal-body">
                <h2>O que √© uma Equa√ß√£o?</h2>
                <div class="definition-box"><strong>Defini√ß√£o:</strong> "Toda senten√ßa aberta expressa por uma igualdade √© uma equa√ß√£o."</div>
                <h3>Membros e Termos</h3>
                <div class="example-box" style="text-align: center;">$$ \underbrace{7x + 3}_{\text{1.¬∫ Membro}} = \underbrace{11x - 5}_{\text{2.¬∫ Membro}} $$</div>
                <h3>Raiz de uma Equa√ß√£o</h3>
                <p>√â o valor da inc√≥gnita que transforma a equa√ß√£o numa senten√ßa verdadeira.</p>
                <h3>Princ√≠pio da Igualdade</h3>
                <p>O Princ√≠pio da Balan√ßa: o que fazes num lado, tens de fazer no outro.</p>
            </div>
            <div id="tab-solve" class="modal-body hidden">
                <h2>Resolu√ß√£o</h2>
                <p>Exemplo Aditivo: $5x + 3 = 38 \Rightarrow 5x = 35$</p>
                <p>Exemplo Multiplicativo: $5x = 35 \Rightarrow x = 7$</p>
            </div>
            <div id="tab-act" class="modal-body hidden">
                <h2>Atividades</h2>
                <div class="activity-item"><strong>1.</strong> $x + 5 = 8$ <button class="btn btn-small btn-secondary" onclick="toggleAns('ans1')">Solu√ß√£o</button><div id="ans1" class="hidden">$$x=3$$</div></div>
                <div class="activity-item"><strong>2.</strong> $x - 7 = -7$ <button class="btn btn-small btn-secondary" onclick="toggleAns('ans2')">Solu√ß√£o</button><div id="ans2" class="hidden">$$x=0$$</div></div>
            </div>
            <div id="tab-prob" class="modal-body hidden">
                <h2>Problemas</h2>
                <div class="activity-item"><p>O dobro de um n√∫mero somado com 5 √© 91.</p><button class="btn btn-small btn-secondary" onclick="toggleAns('sol1')">Solu√ß√£o</button><div id="sol1" class="hidden">$$2x+5=91 \Rightarrow x=43$$</div></div>
            </div>
            <div id="tab-plan" class="modal-body hidden">
                <h2>Plano de Aula (Infografia)</h2>
                <p>Este guia visual ajuda o professor a integrar a aplica√ß√£o na sala de aula. Clique na imagem para ampliar.</p>
                <div style="text-align: center;">
                    <img src="./infografia-plano.jpg" alt="Infografia do Plano de Aula" class="zoomable-img" onclick="toggleZoom(this)" style="max-width: 100%; height: auto; border: 2px solid #ddd; border-radius: 8px;">
                </div>
            </div>
            <div style="padding: 15px; text-align: center; border-top: 1px solid #ddd;">
                <button class="btn" style="margin: 0;" onclick="closeGuide()">Fechar Guia</button>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DADOS GLOBAL ---
        const questions = [
            { id: 1, phase: "Visual", text: "Equilibra a balan√ßa:", type: "balance", left: { boxes: 1, units: 2 }, right: { boxes: 0, units: 5 }, equation: "$$x + 2 = 5$$", answer: 3, hint: "Retira 2 de cada lado.", explanation: "x = 3" },
            { id: 2, phase: "Visual", text: "Equilibra a balan√ßa:", type: "balance", left: { boxes: 1, units: 4 }, right: { boxes: 0, units: 10 }, equation: "$$x + 4 = 10$$", answer: 6, hint: "Retira 4 de cada lado.", explanation: "x = 6" },
            { id: 3, phase: "Visual", text: "Caixas dos dois lados!", type: "balance", left: { boxes: 2, units: 0 }, right: { boxes: 1, units: 5 }, equation: "$$2x = x + 5$$", answer: 5, hint: "Tira um x de cada lado.", explanation: "x = 5" },
            { id: 4, phase: "M√°quina", text: "Inverso de multiplicar:", type: "machine", visual: "‚öôÔ∏è ( x 2 ) -> 8", equation: "$$2x = 8$$", answer: 4, hint: "Divide por 2.", explanation: "x = 4" },
            { id: 5, phase: "M√°quina", text: "Dois passos:", type: "machine", visual: "‚öôÔ∏è x 2 + 4 = 12", equation: "$$2x + 4 = 12$$", answer: 4, hint: "Subtrai 4, depois divide.", explanation: "x = 4" },
            { id: 6, phase: "Contexto", text: "Triplo menos 4 √© 23.", type: "text", visual: "üìù Contexto", equation: "$$3x - 4 = 23$$", answer: 9, hint: "3x = 27", explanation: "x = 9" },
            { id: 7, phase: "Contexto", text: "T√°xi: 2‚Ç¨ + 1,5‚Ç¨/km = 5‚Ç¨", type: "text", visual: "üöï T√°xi", equation: "$$1,5x + 2 = 5$$", answer: 2, hint: "1,5x = 3", explanation: "x = 2" },
            { id: 8, phase: "Mestre", text: "Fra√ß√µes:", type: "text", visual: "üèÜ Fra√ß√£o", visualHint: "Tira 1, depois multiplica.", equation: "$$\\frac{x}{2} + 1 = 5$$", answer: 8, hint: "x/2 = 4", explanation: "x = 8" }
        ];

        // --- NAVEGA√á√ÉO CORRIGIDA ---
        const allScreens = ['screen-menu', 'screen-games-menu', 'screen-game-board', 'screen-game-memory', 'screen-game-domino', 'screen-game-bingo', 'screen-game', 'screen-lab', 'screen-report'];
        
        function hideAllScreens() {
            allScreens.forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        function showMenu() { hideAllScreens(); document.getElementById('screen-menu').classList.remove('hidden'); }
        function showGamesMenu() { hideAllScreens(); document.getElementById('screen-games-menu').classList.remove('hidden'); }
        function openGuide() { document.getElementById('modal-guide').style.display = 'flex'; MathJax.typesetPromise(); }
        function closeGuide() { document.getElementById('modal-guide').style.display = 'none'; }
        function switchTab(id) {
            ['tab-def', 'tab-solve', 'tab-act', 'tab-prob', 'tab-plan'].forEach(i => document.getElementById(i).classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.remove('hidden');
            event.target.classList.add('active');
        }
        function toggleAns(id) { const el = document.getElementById(id); el.classList.toggle('hidden'); MathJax.typesetPromise([el]); }
        function toggleZoom(img) { img.classList.toggle('zoomed'); }

        // --- ESTADO E JOGO ORIGINAL ---
        let currentQuestionIndex = 0, score = 0, lives = 3, userAnswers = [];
        let labState = { xValue: 5, left: { x: 1, u: 0 }, right: { x: 0, u: 5 } };

        function startGame() {
            currentQuestionIndex = 0; score = 0; lives = 3; userAnswers = [];
            hideAllScreens(); document.getElementById('screen-game').classList.remove('hidden');
            updateStats(); loadQuestion();
        }
        function loadQuestion() {
            const q = questions[currentQuestionIndex];
            document.getElementById('level-indicator').innerText = `N√≠vel ${currentQuestionIndex + 1}`;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIndex)/questions.length)*100}%`;
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('btn-check').classList.remove('hidden');
            document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('user-input').value = '';
            
            const h = document.getElementById('visual-hint-container'); h.innerHTML = ''; h.classList.add('hidden');
            const btnH = document.getElementById('btn-visual-hint');
            q.visualHint ? (btnH.classList.remove('hidden'), h.innerHTML = q.visualHint) : btnH.classList.add('hidden');

            document.getElementById('question-text').innerText = q.text;
            document.getElementById('question-equation').innerText = q.equation;

            const ba = document.getElementById('balance-area');
            const va = document.getElementById('visual-text-area');
            if(q.type === 'balance') { va.classList.add('hidden'); renderBalance(q.left, q.right, 'balance-area'); }
            else { ba.classList.add('hidden'); va.classList.remove('hidden'); va.innerHTML = q.visual; }
            MathJax.typesetPromise();
        }
        function showVisualHint() { document.getElementById('btn-visual-hint').classList.add('hidden'); document.getElementById('visual-hint-container').classList.remove('hidden'); MathJax.typesetPromise(); }
        function checkAnswer() {
            const val = parseFloat(document.getElementById('user-input').value);
            const q = questions[currentQuestionIndex];
            const fb = document.getElementById('feedback-area');
            if(isNaN(val)) { alert("Insere um n√∫mero."); return; }
            if(val === q.answer) {
                score += 100 + (lives*10); fb.innerHTML = `<strong>Correto!</strong> ${q.explanation}`; fb.className = 'feedback correct';
                userAnswers.push({id:q.id, correct:true}); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
            } else {
                lives--; fb.innerHTML = `<strong>Errado...</strong> Dica: ${q.hint}`; fb.className = 'feedback incorrect';
                if(lives===0) { endGame(); return; }
            }
            fb.style.display = 'block'; updateStats(); MathJax.typesetPromise([fb]);
        }
        function nextQuestion() { currentQuestionIndex++; if(currentQuestionIndex<questions.length) loadQuestion(); else endGame(); }
        function updateStats() { document.getElementById('score').innerText = score; document.getElementById('lives').innerText = lives; }
        function endGame() {
            hideAllScreens(); document.getElementById('screen-report').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            let html = "<ul>";
            questions.forEach((q,i) => { const a = userAnswers.find(x => x.id === q.id); html += `<li>N√≠vel ${i+1}: ${a && a.correct ? '‚úÖ' : '‚ùå'}</li>`; });
            document.getElementById('report-details').innerHTML = html + "</ul>";
        }

        // --- LABORAT√ìRIO (COM CORRE√á√ÉO DE INCLINA√á√ÉO) ---
        function startLab() {
            hideAllScreens(); document.getElementById('screen-lab').classList.remove('hidden');
            renderBalance({boxes:0, units:0},{boxes:0, units:0}, 'lab-balance-area'); updateLab();
        }
        function adjustLab(s, t, d) { if(labState[s][t] + d >= 0) { labState[s][t] += d; updateLab(); } }
        function updateLab() {
            labState.xValue = parseInt(document.getElementById('lab-x-value').value);
            document.getElementById('lab-x-display').innerText = labState.xValue;
            ['left','right'].forEach(s => { document.getElementById(`count-${s}-x`).innerText = labState[s].x; document.getElementById(`count-${s}-u`).innerText = labState[s].u; });

            renderBalance({boxes:labState.left.x, units:labState.left.u}, {boxes:labState.right.x, units:labState.right.u}, 'lab-balance-area');
            
            const wL = (labState.left.x * labState.xValue) + labState.left.u;
            const wR = (labState.right.x * labState.xValue) + labState.right.u;
            const beam = document.getElementById('lab-balance-area-beam');
            if(beam) {
                beam.classList.remove('tilt-left', 'tilt-right', 'balanced');
                beam.classList.add(wL > wR ? 'tilt-left' : (wR > wL ? 'tilt-right' : 'balanced'));
            }
            const term = (s) => { const x = labState[s].x > 0 ? (labState[s].x > 1 ? `${labState[s].x}x` : 'x') : ''; const u = labState[s].u > 0 ? (x ? `+${labState[s].u}` : `${labState[s].u}`) : ''; return (x+u) || '0'; };
            const sym = wL > wR ? '>' : (wR > wL ? '<' : '=');
            const col = wL === wR ? '#27ae60' : '#e74c3c';
            const eq = `$$ ${term('left')} \\quad \\color{${col}}{${sym}} \\quad ${term('right')} $$`;
            const el = document.getElementById('lab-equation'); el.innerHTML = eq; MathJax.typesetPromise([el]);
        }

        function renderBalance(l, r, id) {
            const c = document.getElementById(id);
            if(!c.querySelector('.balance-container')) {
                c.innerHTML = `<div class="balance-container"><div class="balance-beam" id="${id}-beam"><div class="pan-string string-l1"></div><div class="pan-string string-l2"></div><div class="pan-plate plate-left" id="${id}-plate-left"></div><div class="pan-string string-r1"></div><div class="pan-string string-r2"></div><div class="pan-plate plate-right" id="${id}-plate-right"></div></div><div class="balance-fulcrum"></div></div>`;
                c.classList.remove('hidden');
            }
            const pl = document.getElementById(`${id}-plate-left`); pl.innerHTML = '';
            for(let i=0; i<l.boxes; i++) pl.innerHTML += `<div class="weight-box">x</div>`;
            for(let i=0; i<l.units; i++) pl.innerHTML += `<div class="weight-circle">1</div>`;
            const pr = document.getElementById(`${id}-plate-right`); pr.innerHTML = '';
            for(let i=0; i<r.boxes; i++) pr.innerHTML += `<div class="weight-box">x</div>`;
            for(let i=0; i<r.units; i++) pr.innerHTML += `<div class="weight-circle">1</div>`;
        }

        // --- JOGO 1: TABULEIRO ---
        let boardPos = 0, boardQ = null;
        function startBoardGame() { hideAllScreens(); document.getElementById('screen-game-board').classList.remove('hidden'); boardPos = 0; renderBoard(); }
        function renderBoard() {
            const c = document.getElementById('board-container'); c.innerHTML = '';
            for(let i=0; i<20; i++) {
                const cell = document.createElement('div'); cell.className = 'board-cell';
                if(i===0) { cell.innerText = 'Inicio'; cell.classList.add('start'); } else if(i===19) { cell.innerText = 'Fim'; cell.classList.add('finish'); } else { cell.innerText = i; }
                if(i === boardPos) { const t = document.createElement('div'); t.className = 'player-token'; cell.appendChild(t); }
                c.appendChild(cell);
            }
        }
        function rollDice() {
            const steps = Math.floor(Math.random() * 3) + 1; boardQ = questions[Math.floor(Math.random() * questions.length)];
            document.getElementById('modal-board-question').style.display = 'flex';
            document.getElementById('board-q-text').innerHTML = `Avan√ßa <strong>${steps}</strong> casas se resolveres:<br>${boardQ.equation}`;
            document.getElementById('board-input').value = ''; document.getElementById('board-feedback').innerHTML = ''; document.getElementById('board-input').focus();
            document.getElementById('modal-board-question').dataset.steps = steps; MathJax.typesetPromise();
        }
        function checkBoardAnswer() {
            const val = parseFloat(document.getElementById('board-input').value);
            const steps = parseInt(document.getElementById('modal-board-question').dataset.steps);
            const fb = document.getElementById('board-feedback');
            if(val === boardQ.answer) {
                fb.innerHTML = "<span style='color:green'>Correto! A avan√ßar...</span>";
                setTimeout(() => { document.getElementById('modal-board-question').style.display = 'none'; boardPos += steps; if(boardPos>=19) { boardPos=19; renderBoard(); alert("Parab√©ns!"); } else { renderBoard(); } }, 1000);
            } else { fb.innerHTML = "<span style='color:red'>Errado!</span>"; setTimeout(() => { document.getElementById('modal-board-question').style.display = 'none'; }, 1000); }
        }

        // --- JOGO 2: MEM√ìRIA ---
        let memoryCards = [], flippedCards = [], memoryScore = 0;
        const memoryPairs = [{id:1,eq:"$$x+2=5$$",sol:"$$x=3$$"},{id:2,eq:"$$2x=8$$",sol:"$$x=4$$"},{id:3,eq:"$$x-1=2$$",sol:"$$x=3$$"},{id:4,eq:"$$3x=9$$",sol:"$$x=3$$"},{id:5,eq:"$$x+5=10$$",sol:"$$x=5$$"},{id:6,eq:"$$2x+1=5$$",sol:"$$x=2$$"}];
        function startMemoryGame() {
            hideAllScreens(); document.getElementById('screen-game-memory').classList.remove('hidden'); document.getElementById('btn-restart-memory').classList.add('hidden');
            memoryScore = 0; document.getElementById('memory-score').innerText = 0; flippedCards = [];
            let deck = []; memoryPairs.forEach(p => { deck.push({id:p.id,c:p.eq}); deck.push({id:p.id,c:p.sol}); });
            deck.sort(() => Math.random() - 0.5);
            const g = document.getElementById('memory-container'); g.innerHTML = '';
            deck.forEach((c, i) => {
                const el = document.createElement('div'); el.className = 'memory-card'; el.dataset.id = c.id;
                el.innerHTML = '<span style="display:none">' + c.c + '</span><span>‚ùì</span>';
                el.onclick = () => flipCard(el, c.c); g.appendChild(el);
            });
            MathJax.typesetPromise();
        }
        function flipCard(el, content) {
            if(el.classList.contains('flipped') || el.classList.contains('matched') || flippedCards.length >= 2) return;
            el.classList.add('flipped'); el.innerHTML = '<div style="transform: rotateY(180deg); text-align: center;">' + content + '</div>'; MathJax.typesetPromise([el]);
            flippedCards.push(el);
            if(flippedCards.length === 2) {
                if(flippedCards[0].dataset.id === flippedCards[1].dataset.id) {
                    flippedCards.forEach(c => c.classList.add('matched')); memoryScore++; document.getElementById('memory-score').innerText = memoryScore; flippedCards = [];
                    if(memoryScore === memoryPairs.length) document.getElementById('btn-restart-memory').classList.remove('hidden');
                } else { setTimeout(() => { flippedCards.forEach(c => { c.classList.remove('flipped'); c.innerHTML = '<span>‚ùì</span>'; }); flippedCards = []; }, 1000); }
            }
        }

        // --- JOGO 3: DOMIN√ì ---
        let dominoHand = [], dominoTable = [];
        const dominoData = [{l:"In√≠cio",r:"$$x+1=3$$"},{l:"$$x=2$$",r:"$$2x=8$$"},{l:"$$x=4$$",r:"$$x-1=5$$"},{l:"$$x=6$$",r:"$$3x=15$$"},{l:"$$x=5$$",r:"$$x+x=10$$"},{l:"$$x=5$$",r:"$$4x=4$$"},{l:"$$x=1$$",r:"Fim"}];
        function startDominoGame() {
            hideAllScreens(); document.getElementById('screen-game-domino').classList.remove('hidden'); document.getElementById('btn-restart-domino').classList.add('hidden'); document.getElementById('domino-msg').innerText = "";
            dominoTable = []; dominoHand = [...dominoData];
            dominoTable.push(dominoHand.shift()); dominoHand.sort(() => Math.random() - 0.5); renderDomino();
        }
        function renderDomino() {
            const t = document.getElementById('domino-table'); t.innerHTML = '';
            dominoTable.forEach(p => t.innerHTML += `<div class="domino-piece on-table"><div class="domino-half">${p.l}</div><div class="domino-half">${p.r}</div></div>`);
            const h = document.getElementById('domino-hand'); h.innerHTML = '';
            dominoHand.forEach((p, i) => {
                const d = document.createElement('div'); d.className = 'domino-piece'; d.innerHTML = `<div class="domino-half">${p.l}</div><div class="domino-half">${p.r}</div>`;
                d.onclick = () => playDomino(i); h.appendChild(d);
            });
            if(dominoHand.length === 0) { document.getElementById('domino-msg').innerText = "Parab√©ns!"; document.getElementById('btn-restart-domino').classList.remove('hidden'); }
            MathJax.typesetPromise();
        }
        function playDomino(i) {
            const p = dominoHand[i]; const last = dominoTable[dominoTable.length-1];
            const sols = {"$$x+1=3$$":"$$x=2$$","$$2x=8$$":"$$x=4$$","$$x-1=5$$":"$$x=6$$","$$3x=15$$":"$$x=5$$","$$x+x=10$$":"$$x=5$$","$$4x=4$$":"$$x=1$$"};
            if(p.l === sols[last.r]) { dominoHand.splice(i, 1); dominoTable.push(p); document.getElementById('domino-msg').innerText = "Boa jogada!"; renderDomino(); } 
            else { document.getElementById('domino-msg').innerText = "N√£o encaixa!"; }
        }

        // --- JOGO 4: BINGO ---
        let bingoNumbers = [], bingoCalled = [], bingoCurrentTarget = null, bingoCurrentExpl = "";
        function startBingoGame() {
            hideAllScreens(); document.getElementById('screen-game-bingo').classList.remove('hidden');
            bingoNumbers = []; bingoCalled = []; document.getElementById('bingo-current-call').innerHTML = '...'; document.getElementById('bingo-status').innerText = ''; document.getElementById('btn-next-bingo').classList.remove('hidden');
            const pool = Array.from({length:20}, (_,i)=>i+1).sort(()=>Math.random()-0.5); bingoNumbers = pool.slice(0,9); renderBingoCard();
        }
        function renderBingoCard() {
            const g = document.getElementById('bingo-card'); g.innerHTML = '';
            bingoNumbers.forEach(n => {
                const c = document.createElement('div'); c.className = 'bingo-cell'; c.innerText = n;
                c.onclick = () => checkBingoClick(c, n); g.appendChild(c);
            });
        }
        function nextBingoCall() {
            let pool = Array.from({length:20}, (_,i)=>i+1).filter(n => !bingoCalled.includes(n));
            if(pool.length === 0) { document.getElementById('bingo-status').innerText = "Fim!"; document.getElementById('btn-next-bingo').classList.add('hidden'); return; }
            const t = pool[Math.floor(Math.random()*pool.length)]; bingoCalled.push(t); bingoCurrentTarget = t;
            const data = generateBingoEquation(t); bingoCurrentExpl = data.exp;
            const d = document.getElementById('bingo-current-call'); d.innerHTML = data.text; MathJax.typesetPromise([d]);
            document.getElementById('bingo-status').innerText = "Procura na cartela!";
        }
        function generateBingoEquation(r) {
            const t = Math.floor(Math.random()*3);
            if(t===0) { const a=Math.floor(Math.random()*10)+1; return {text:`$$x + ${a} = ${r+a}$$`, exp:`Para isolar x, subtrai ${a}: $$x = ${r+a} - ${a} = ${r}$$`}; }
            else if(t===1) { const a=Math.floor(Math.random()*5)+1; return {text:`$$x - ${a} = ${r-a}$$`, exp:`Para isolar x, soma ${a}: $$x = ${r-a} + ${a} = ${r}$$`}; }
            else { const a=Math.floor(Math.random()*4)+2; return {text:`$$${a}x = ${a*r}$$`, exp:`Divide por ${a}: $$x = \\frac{${a*r}}{${a}} = ${r}$$`}; }
        }
        function checkBingoClick(c, n) {
            if(n === bingoCurrentTarget) {
                if(!c.classList.contains('marked')) {
                    c.classList.add('marked'); const s = document.getElementById('bingo-status');
                    s.innerHTML = "<span style='color:green; font-size: 1.1rem;'>Correto! ‚úÖ</span><br>" + bingoCurrentExpl; MathJax.typesetPromise([s]);
                    if(document.querySelectorAll('.bingo-cell.marked').length === 9) alert("BINGO!");
                }
            } else { document.getElementById('bingo-status').innerHTML = "<span style='color:red'>Errado!</span>"; }
        }
    </script>
</body>
</html>